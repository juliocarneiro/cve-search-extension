import React, { useEffect } from 'react';
import { withRouter } from 'react-router-dom';
import axios from 'axios';
import { Card } from 'react-bootstrap';
import useCves from 'stores/getAllCves';
import Spinner from 'components/Spinner';
import { Wrapper } from './styles';

const { REACT_APP_API_CVES_GET, REACT_APP_API_KEY } = process.env;

function Home() {
  const [cves, setCves] = useCves();

  const getAllCves = () => {
    axios
      .get(`${REACT_APP_API_CVES_GET}?api_key=${REACT_APP_API_KEY}`)
      .then((response) => {
        setCves(response.data.result.CVE_Items);
      })
      .catch((error) => error);
  };

  useEffect(() => {
    getAllCves();
  }, []);

  return cves.length > 0 ? (
    <Wrapper className="animate__animated animate__fadeIn animate__fast">
      <img
        src="./logo.png"
        alt="logo"
        width={200}
        height="auto"
        className="mb-4"
      />
      {cves.map((cve: any) => (
        <Card
          bg="Secondary"
          key={cve.cve.CVE_data_meta.ID}
          text="dark"
          className="mb-3"
        >
          <Card.Header>{cve.cve.CVE_data_meta.ID}</Card.Header>
          <Card.Body>
            <Card.Text>
              {cve.cve.description.description_data[0].value}
            </Card.Text>
          </Card.Body>
        </Card>
      ))}
    </Wrapper>
  ) : (
    <Spinner />
  );
}

export default withRouter(Home);
